define("tag",["doc"],function(e){"use strict";var t=188,n=13,r=9,i=8,l=46,a=37,u=39,s=function(e,t){return e.which===t||e.keyCode===t},f=function(e,t){return t.some(function(t){return s(e,t)})},d=function(d){var o=[],c=null,m=!d.filter("required").isEmpty(),p=e(document.createElement("fieldset")),v=e(document.createElement("ul")),g=e(document.createElement("li"));v.addClass("tags"),p.addClass("tags-container").attr("tabindex","1").append(v.first()),d.parent().first().insertBefore(p.first(),d.first()),v.append(g.first()),g.addClass("input-tag").append(d.first()),p.on("input",function(e){e.target.value.indexOf(",")>=0&&E()}),p.on("keydown",function(e){d.removeClass("error"),f(e,[n,t,r])?(e.preventDefault(),E()):null!==c&&f(e,[i,l])?(y(c),c=null):f(e,[i,a])?""===d.val()&&(null===c&&o.length>0?c=o.length-1:c>0&&c--):s(e,u)?c===o.length-1?c=null:null!==c&&c++:c=null,h(c)});var h=function(e){if(v.find(".selected").removeClass("selected"),null!==e){var t=o[e];p.find('input[value="'+t+'"]').parent().addClass("selected")}else d.focus()},C=function(e,t){return e.indexOf(t)<0&&e.push(t.trim()),e},E=function(){var e=d.val().trim().split(/\s*,\s*/).filter(function(e){return e.length>0&&o.indexOf(e.trim())<0}).reduce(C,[]);if(e.length>0){for(var t=0;t<e.length;t++)x(e[t]);d.val("")}else d.addClass("error")},x=function(t){var n=e(document.createElement("li")),r=e(document.createElement("input")),i=e(document.createElement("button"));i.addClass("close").html("&times;"),r.attr("type","hidden").attr("name",d.attr("name")).val(t),n.text(t),n.addClass("tag").append(r.first()),n.append(i.first()),v.first().insertBefore(n.first(),g.first()),d.removeAttr("required"),i.on("click",function(e){e.stopImmediatePropagation();var t=o.indexOf(r.val());y(t),c=null,h(c),d.focus()}),n.on("click",function(){var e=o.indexOf(r.val());c=e,h(c)}),o.push(t)},y=function(t){if(o.splice(t,1).length>0){var n=v.find(".tag").els[t];e(n).removeItem()}m&&0===o.length&&d.attr("required","")};E(),this.tags=function(){return o},this.selected=function(){return null!==c?o[c]:null}},o=function(t){var n=e(t);return n.isEmpty()?null:new d(n)};return{tagify:o}});
