define("tag",["doc"],function(e){"use strict"
var t=function(e,t){return e.which===t||e.keyCode===t},n=function(e,n){return n.some(function(n){return t(e,n)})},r=function(r,a){var l=[],i=null,d=!r.filter("required").isEmpty(),s=e(document.createElement("fieldset")),u=e(document.createElement("ul")),c=e(document.createElement("li"))
u.addClass("tags"),s.addClass("tags-container").attr("tabindex","1").append(u.first()),r.parent().first().insertBefore(s.first(),r.first()),u.append(c.first()),c.addClass("input-tag").append(r.first()),s.on("input",function(e){e.target.value.indexOf(",")>=0&&m()}),s.on("keydown",function(e){var d=r.hasClass("error")
r.removeClass("error"),d&&a&&a.errorCleared&&a.errorCleared.call&&a.errorCleared.call(null,r.first()),""!==r.val()&&n(e,[13,188,9])?(e.preventDefault(),m(e)):null!==i&&n(e,[8,46])?(v(i),i=null):n(e,[8,37])?""===r.val()&&(null===i&&l.length>0?i=l.length-1:i>0&&i--):t(e,39)?i===l.length-1?i=null:null!==i&&i++:i=null,o(i)})
var o=function(e){if(u.find(".selected").removeClass("selected"),null!==e){var t=l[e]
s.find('input[value="'+t+'"]').parent().addClass("selected")}else r.focus()},f=function(e,t){return e.indexOf(t)<0&&e.push(t.trim()),e},m=function(e){var t=r.val()||r.text(),n=t.trim().split(/\s*,\s*/).filter(function(e){return e.length>0&&l.indexOf(e.trim())<0}).reduce(f,[])
if(n.length>0){for(var i=0;i<n.length;i++)g(n[i],e)
r.val(""),a&&a.added&&a.added.call&&a.added.call(null,n)}else t.trim().length>0&&(r.addClass("error"),a&&a.errorAlreadyExists&&a.errorAlreadyExists.call&&a.errorAlreadyExists.call(null,r.first()))},g=function(t,n){var d=e(document.createElement("li")),s=e(document.createElement("input")),f=e(document.createElement("button")),m=r.attr("maxlength")
if(f.attr("type","button").attr("tabindex","-1").addClass("close").html("&times;"),s.attr("type","hidden").attr("name",r.attr("name")).val(t),d.text(t),d.addClass("tag").append(s.first()),d.append(f.first()),u.first().insertBefore(d.first(),c.first()),r.removeAttr("required"),m){var g=parseInt(m,10)-t.length-1
g<0?(r.attr("data-tag-exact-maxlength","true"),r.attr("maxlength",0)):r.attr("maxlength",g),g<=0&&n&&a&&a.maxlengthExceeded&&a.maxlengthExceeded.call&&a.maxlengthExceeded.call(null)}f.on("click",function(e){e.stopImmediatePropagation()
var t=l.indexOf(s.val())
v(t),i=null,o(i),r.focus()}),d.on("click",function(){var e=l.indexOf(s.val())
i=e,o(i)}),l.push(t)},v=function(t){var n=l[t]
if(l.splice(t,1).length>0){var i=u.find(".tag").els[t],s=r.attr("maxlength")
if(e(i).removeItem(),s){var c=parseInt(s,10),o=c+n.length+1
0===c&&r.attr("data-tag-exact-maxlength")&&(o--,r.removeAttr("data-tag-exact-maxlength")),r.attr("maxlength",o)}}d&&0===l.length&&r.attr("required",""),a&&a.removed&&a.removed.call&&a.removed.call(null,n)}
m(),this.tags=function(){return l},this.selected=function(){return null!==i?l[i]:null}}
return{tagify:function(t,n){var a=e(t)
return a.isEmpty()?null:new r(a,n)}}})
